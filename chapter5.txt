This is chapter 5 in test-branch. V1